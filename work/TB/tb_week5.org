
* 测试与评估

  
  1. 回测

     - 回测速度快

     - 与实际运行很大区别

  2. 模拟盘

     - 冲击成本无法模拟 -- 什么是冲击成本？ 譬如卖盘挂了 10 单，买盘挂了 20 单，那么吃掉 10 单后，卖盘
       价格肯定会再涨。

     - 如果是日线级别的策略，模拟盘运行需要时间长，很可能需要几个月时间

     - 很可能模拟盘运行的时候，行情处于单一行情

  3. 测试设置

     1. 商品设置

        - 样本 --> 范围

          + 注意：夜盘按道理是第二天的行情，但是如果设置样本范围是 1 天的时候，是没有夜盘数据的

        - 属性
          
          + 最小变动：一跳

          + 交易单位：每一手交易多少单位，K 线图上价格是 1 个单位的价格

          + 每点价值：股指期货比较特殊，一般是 1 点 300 元；商品期货一般就是 1 点 1 元

        - 交易

          + 保证金率：可以稍微调大些，保证有一定回撤余地

          + 委托偏移：与模拟盘有关

          + 手续费：Cu --> 不收平今仓手续费；大部分是双向收手续费；Au --> 费率方式一般是固定 1 手 10 这样的方式收费

          + 滑点：一般用 '跳/手'， 一般最大不会超过 10 跳，5 跳就是比较大的波动

     2. 公式应用设置

        - 图表交易设定
          
          + 初始资金：如果设置的值比较小，可能会出现爆仓，因此一定要设置够

          + 允许连续建仓：如果策略需要连续建仓，这里要打开

          + 计算前 N 个较大资产回撤的平均值：因此测试报告中已经有了最大资产回撤，因此这边可以设置 5 左右，看看整体回撤情况

     3. 测试报告
        
        可以在工具 --> 测试报告里看到策略的性能测试报告，可以保存，保存格式为网页格式

     4. 滑点
        
        价格一般不大可能以当前价位成交，可能出现价格损耗，价格损耗的影响可以用滑点来表示，滑点损耗在测试报告中展示在手续费中。

        [[file:week5/huadian_01.png]]

        上图是不设滑点，应用双均线策略，测试报告中成交记录的某一单，买一手，卖一手，双向收费，手续费是每手 10 元，因此对应的
        佣金是 20 元。

        [[file:week5/huadian_02.png]]

        上图则是加上了滑点后佣金变化，滑点设为 2 跳，黄金 1 手 1000 克，1 跳对应 0.05 元，因此，每手对应的滑点是 100 元，
        买一手，卖一手，正好是 200 元，加上 20 元手续费，佣金变为 220 元。

     5. 测试报告解读

        - 净利润：总盈利 - 总亏损 (包含了手续费和滑点)

        - 交易手数：表示做了多少次交易，不是指买了或者卖了多少手合约

        - 盈利比率：盈利手数/交易手续

        - 平均利润：净利润/交易总手数

        - 平均盈利：总盈利/盈利手数

        - 平均亏损：总亏损/亏损手数

        - 平均盈利/平均亏损：体现了盈利的效率值 --> 凯利公式

        - 最大盈利：所有盈利的交易里，盈利最多的一笔交易盈利额

        - 最大亏损：所有亏损交易里，亏损最多的一笔交易亏损额

        - 最大盈利/总盈利：可以看到盈利的分布

        - 最大使用资金：Max（交易手数 x 保证金率 x 市值）

        - 收益率：净利润/初始资金

        - 有效收益率：净利润/最大使用资金

        - 收益曲线斜率：收益曲线终值与收益曲线初值的连线斜率

        - 收益曲线 R 平方值：

        - 夏普比率：

        - 收益风险比：年化收益/最大资产回撤 --> 回测报告中没有 --> /策略评估最重要的指标之一/

        - 调整的收益风险比：年化收益/平均资产回撤 --> 回测报告中没有 --> /策略评估重要指标之一/

        - 平均浮动盈亏：所有交易最大浮动盈利/最大浮动亏损

        - 建仓效率：(最佳平仓价-开仓价)/(最佳平仓价-最佳开仓价)

        - 平仓效率： (平仓价-最佳开仓价)/(最佳平仓价-最佳开仓价)

        - 总效率： (平仓价-开仓价)/(最佳平仓价-最佳开仓价)

          - 最佳平仓价：建仓后浮动盈利最大的价格

          - 最佳开仓价：建仓后浮动亏损最大的价格 --> 就是最差平仓价

* 
* 

* 优化
  
  1. 优化目标

  2. 优化参数

  3. 自动选参设置 --> 模板设置

     #+BEGIN_EXAMPLE
       Max(净利润, 0.3)
     #+END_EXAMPLE

     表示取净利润最大的前 30% 的参数。

     #+BEGIN_EXAMPLE
       Ptg(净利润, 0.3, 0.5)
     #+END_EXAMPLE
     
     表示净利润在 30% 到 50% 之间的一个范围。

  4. 加入队列 --> 批量优化

  5. 多品种优化

  6. 默认设置
     
     - 设定 --> 品种交易默认设定

     - 文件 --> 设置所有图表参数

* 模拟交易
  
  1. 可以同时运行多个公式
  2. 多品种同时交易 --> 每个品种单独设置
  3. 委托偏移 
     - 如果用指数(000 或 888)进行交易

       公式应用设置 --> 图表交易设定 --> 交易账户 (D0->主力合约)

     - 偏移 x 跳 --> 如果以心理价位进行交易可能不能成交，可以设置跳数，
       这样，每次发单都会偏移 x 跳进行发单，不一定会以委托的价格成交，
       按实际撮合交易价格为准，譬如，发单价格比委卖价高，那么交易所会
       以委卖价进行撮合成交。
